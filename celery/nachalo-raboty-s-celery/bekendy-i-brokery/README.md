# Бэкэнды и брокеры

В этом документе описывается текущая стабильная версия **Celery** (5.2). Для документации по разработке [перейдите сюда](http://docs.celeryproject.org/en/master/index.html).

## Бэкэнды и брокеры

Выпуск: 5.2

Дата: 3 апреля 2022

Celery поддерживает несколько альтернатив передачи сообщений.

## Инструкции для брокера

* [Использование RabbitMQ](ispolzovanie-rabbitmq.md)
* [Использование Redis](ispolzovanie-redis.md)
* [Использование Amazon SQS](ispolzovanie-amazon-sqs.md)

## Обзор брокеров

Это сравнительная таблица различных поддерживаемых транспортов, дополнительную информацию можно найти в документации по каждому отдельному транспорту (см. [Инструкции брокера](./#instrukcii-dlya-brokera)).

| Название   | Статус            | Мониторинг | Удаленный контроль |
| ---------- | ----------------- | ---------- | ------------------ |
| RabbitMQ   | стабильный        | Да         | Да                 |
| Redis      | стабильный        | Да         | Да                 |
| Amazon SQS | стабильный        | Нет        | Нет                |
| Zookeeper  | экспериментальный | Нет        | Нет                |

Экспериментальные брокеры могут быть функциональными, но у них нет выделенных специалистов по сопровождению.

Отсутствие поддержки мониторинга означает, что транспорт не реализует события, и поэтому Flower, celery Events, celerymon и другие инструменты мониторинга на основе событий не будут работать.

Удаленное управление означает возможность проверять и управлять воркерами во время выполнения с помощью команд `celery inspect` и `celery control` (и других инструментов, использующих API удаленного управления).

## Сводки

{% hint style="info" %}
**Примечание**.

Этот раздел не содержит исчерпывающих сведений о бэкэндах и брокерах.
{% endhint %}

Celery имеет возможность взаимодействовать и хранить данные со многими различными бэкендами (хранилища результатов) и брокерами (транспорты сообщений).

## Redis

**Redis** может быть как серверной частью, так и брокером.

**Как брокер**: Redis хорошо работает для быстрой передачи небольших сообщений. Большие сообщения могут перегрузить систему.

[Подробнее см. в документации](ispolzovanie-redis.md)

**В качестве бэкенда**: Redis — это сверхбыстрое хранилище K/V, что делает его очень эффективным для получения результатов вызова задачи. Как и в случае с дизайном Redis, вы должны учитывать ограничение памяти, доступной для хранения ваших данных, и то, как вы обрабатываете постоянство данных. Если постоянство результатов важно, рассмотрите возможность использования другой БД для вашего бэкэнда.

## RabbitMQ

**RabbitMQ** — это брокер.

**Как брокер**: RabbitMQ обрабатывает большие сообщения лучше, чем Redis, однако, если много сообщений поступает очень быстро, масштабирование может стать проблемой, и следует рассмотреть Redis или SQS, если только RabbitMQ не работает в очень больших масштабах.

[Подробнее см. в документации](ispolzovanie-rabbitmq.md)

**В качестве бэкэнда**: RabbitMQ может сохранять результаты через бэкэнд `rpc://`. Этот бэкенд создает отдельную временную очередь для каждого клиента.

{% hint style="info" %}
**Примечание**.

RabbitMQ (как брокер) и Redis (как серверная часть) очень часто используются вместе. Если требуется более гарантированное долгосрочное сохранение из хранилища результатов, рассмотрите возможность использования PostgreSQL или MySQL (через SQLAlchemy), Cassandra или пользовательского определенного бэкэнда.
{% endhint %}

## SQS

**SQS** является брокером.

Если вы уже тесно интегрировались с AWS и знакомы с SQS, это отличный вариант в качестве брокера. Он чрезвычайно масштабируем и полностью управляем, а также управляет делегированием задач аналогично RabbitMQ. В нем отсутствуют некоторые функции брокера RabbitMQ, такие как рабочие команды удаленного управления.

[Подробнее см. в документации](ispolzovanie-amazon-sqs.md)

## SQLAlchemy

**SQLAlchemy** — это серверная часть.

Это позволяет Celery взаимодействовать с MySQL, PostgreSQL, SQlite и другими. Это ORM, и именно так Celery может использовать базу данных SQL в качестве бэкэнда. Исторически сложилось так, что SQLAlchemy не был самым стабильным сервером результатов, поэтому, если вы выбрали его, следует действовать с осторожностью.
